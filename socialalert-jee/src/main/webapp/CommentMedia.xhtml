<ui:composition template="/WEB-INF/templates/MasterTemplate.xhtml" 
	xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"> 
<ui:define name="content">
<p:importConstants type="com.bravson.socialalert.business.media.MediaConstants" var="MediaConstants" />
<f:metadata>
    	<f:viewParam name="uri" value="#{mediaCommentView.mediaUri}" id="uri" />
    	<f:event listener="#{mediaCommentView.startConversation()}" type="preRenderView"></f:event>
</f:metadata>
<p:growl id="messages" showDetail="true" sticky="false" life="2000" />
<p:panel header="Comments">
	<h:form>
	<p:inputTextarea value="#{mediaCommentView.comment}" rows="5" cols="30" counter="commentLength" maxlength="#{MediaConstants.MAX_COMMENT_LENGTH}" counterTemplate="{0} characters remaining." style="width:100%" required="true" requiredMessage="Comment cannot be empty" />
	<h:panelGroup class="ui-g">
		<div class="ui-g-1"><p:commandButton value="Post" action="#{mediaCommentView.postComment()}" ajax="false"></p:commandButton></div>
		<div class="ui-g-1"><span></span></div>
		<div class="ui-g-10"><h:outputText id="commentLength" /></div>
	</h:panelGroup>
	</h:form>
	<p:dataScroller value="#{mediaCommentView.commentList}" var="item" chunkSize="10" lazy="true" styleClass="comment">
		<h:panelGrid>
			<h:panelGroup class="ui-g">
				<div class="ui-g-6"><h:outputText styleClass="#{item.creator.online ? 'online' : 'offline'}" value="#{item.creator.username}" /></div>
				<div class="ui-g-6"><h:outputText value="#{item.creation}" converter="#{prettyInstantConverter}"/></div>
			</h:panelGroup>
			<h:panelGroup styleClass="preformatted">#{item.comment}</h:panelGroup>
			<h:form>
			<h:panelGroup class="ui-g" id="itemInteraction">
				<div class="ui-g-3"><p:commandLink action="#{mediaCommentView.like(item)}" disabled="#{not item.likeAllowed}" process="@form" update="itemInteraction messages"><span class="fa fa-thumbs-o-up"/></p:commandLink><span> #{item.likeCount} </span></div>
                <div class="ui-g-3"><p:commandLink action="#{mediaCommentView.dislike(item)}" disabled="#{not item.dislikeAllowed}" process="@form" update="itemInteraction messages"><span class="fa fa-thumbs-o-down"/></p:commandLink><span> #{item.dislikeCount} </span></div>
                <div class="ui-g-3"><p:commandLink value="REPORT" onclick="PF('reportComment').show();"/></div>
			</h:panelGroup>
			</h:form>
			<p:dialog header="Report comment" widgetVar="reportComment" modal="true" height="200">
				<h:form>
					<h:panelGrid columns="2" cellpadding="5">
				    	<h:outputLabel value="Reason" for="reason"/>
				    	<p:inputTextarea id="reason" rows="5" cols="30"></p:inputTextarea>
				    	
				    	<p:commandButton value="Cancel" onclick="PF('reportComment').hide();"/>
				    	<p:commandButton value="Submit" onclick="PF('reportComment').hide();" type="submit" resetValues="true" action="#{mediaCommentView.reportComment(item)}" process="@form"/>
			    	</h:panelGrid>
			    </h:form>
			</p:dialog>   
		</h:panelGrid>
		<f:facet name="loader">
			<p:commandButton type="button" value="More" icon="ui-icon-circle-triangle-s"/>
		</f:facet>
	</p:dataScroller>
</p:panel>
</ui:define>
</ui:composition>