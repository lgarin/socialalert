<ui:composition template="/WEB-INF/templates/MasterTemplate.xhtml" 
	xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui">
<ui:define name="content">
	<f:metadata>
		<f:event listener="#{userSession.init(request.userPrincipal.keycloakSecurityContext.tokenString)}" type="preRenderView"></f:event>
		<f:viewAction action="#{indexView.loadMediaList()}" />
	</f:metadata>
	<h:form>
	<p:growl id="messages" showDetail="true" sticky="false" life="2000" />  
	<h1>Hello #{userSession.userInfo.username}, your IP is #{userSession.userAccess.ipAddress}.</h1>
	<h:panelGrid columns="3" cellpadding="5">
		<p:outputLabel value="Keyword" for="searchField" />
		<p:autoComplete id="searchField" minQueryLength="3" queryDelay="500" value="#{indexView.keyword}" completeMethod="#{indexView.completeKeyword}" />
		<p:commandButton value="Search" action="#{indexView.loadMediaList()}" ajax="false" />
	</h:panelGrid>
	<p:dataGrid var="media" value="#{indexView.mediaList}" columns="5" rows="4" layout="grid" styleClass="ui-datagrid-no-border">
		<p:panel header="#{media.title}" style="text-align:center">
			<h:panelGrid style="width:320px">
					<h:panelGroup class="ui-g">
						<div class="ui-g-6"><h:outputText styleClass="#{media.creator.online ? 'online' : 'offline'}" value="#{media.creator.username}" /></div>
						<div class="ui-g-6"><h:outputText value="#{media.timestamp}" converter="#{prettyInstantConverter}"/></div>
					</h:panelGroup>
				 	<h:link outcome="ShowMedia" title="View Detail">
		                <p:graphicImage url="/rest/file/thumbnail/#{media.mediaUri}"/> 
		                <f:param name="uri" value="#{media.mediaUri}"></f:param>
	                </h:link>
	                <h:panelGroup class="ui-g">
	                	<div class="ui-g-3"><span class="fa fa-thumbs-o-up"/><span> #{media.likeCount} </span></div>
	                	<div class="ui-g-3"><span class="fa fa-thumbs-o-down"/><span> #{media.dislikeCount} </span></div>
	                	<div class="ui-g-3"><span class="fa fa-eye"/><span> #{media.hitCount} </span></div>
	                	<div class="ui-g-3"><span class="fa fa-comments"/><span> #{media.commentCount} </span></div>
	                </h:panelGroup>
	        </h:panelGrid>
		</p:panel>
	</p:dataGrid>
	</h:form>
</ui:define>
</ui:composition> 
